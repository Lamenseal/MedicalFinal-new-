@using Medical.ViewModel;
@model CReserveforShowViewModel
@{
    ViewData["Title"] = "ReserveList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- Hero Start -->
<div class="container-fluid bg-primary py-5 hero-header mb-5">
    <div class="row py-3">
        <div class="col-12 text-center">
            <h3 class="display-3 text-white animated zoomIn">線上掛號</h3>
        </div>
    </div>
</div>
<!-- Hero End -->
<hr />


<h1>@ViewBag.no</h1>

<div class="col-lg-6">
    <h1 class="text-black-50 mb-4">篩選條件</h1>
    <div class="appointment-form h-100 d-flex flex-column justify-content-center text-center p-5 wow zoomIn" data-wow-delay="0.6s">
        @*<div class="row g-3">*@
        <div class="col-12 col-sm-6">
            <select id="dep" class="form-select bg-light border-0" style="height: 55px;">
                <option selected>選擇科別</option>

                @foreach (var item in Model.departmentList)
                {
                    <option name="@item.DeptName" value="@item.DeptName">@item.DeptName</option>

                }
            </select>
        </div>
        <div class="col-12 col-sm-6">
            <select id="doc" class="form-select bg-light border-0" style="height: 55px;">
                <option>選擇醫生</option>
                @foreach (var item in Model.doctorsList)
                {
                    <option name="@item.DoctorName" value="@item.DoctorName">@item.DoctorName</option>
                }
            </select>
        </div>
        <div class="col-12 col-sm-6">
            <input id="date" type="date" name="txtdate" class="form-control bg-light border-0" placeholder="選擇日期" style="height: 55px;">
        </div>
        @*</div>*@
    </div>
</div>

<div class="col-12">
    <button id="submit" class="btn btn-dark w-100 py-3" type="submit">查詢門診</button>
</div>

<div class="col-12 col-sm-6">
    <div id="count"></div>
    <table id="table1" class="table table-bordered">
    </table> 
</div>

@section scripts
{
    <script>

        //查詢預約
        $('#submit').click(function (evt) {
            evt.preventDefault();
            const doc = $("#doc").val();
            const tre = $("#tre").val();
            const dep = $("#dep").val();
            const date = $("#date").val();
            let count = 0;

            let result =
            `<thead>
            <tr>
                <th>醫生姓名</th>
                <th>治療科別</th>
                <th>治療專長</th>
                <th>看診時段</th>
                <th>診間</th>
                <th>開診日期</th>
                <th>剩餘人數</th>
            </tr>
            </thead>`;

            if (doc == "選擇醫生" || dep == "選擇科別" )
            {
                alert("請選擇篩選項目");
            }
            $.ajax({
                url: '@Url.Content("~/Reserve/ReserveResult")',
                type: "post",
                data: { "doctorname": doc, "departmentname": dep, "treatmentDetailname": tre,"txtdate":date},
                dataType: "json",
                success: function (datas) {
                    $.each(datas, function (index, item) {
                        console.log(item)

                        result += `<tbody><tr><td>${item.doctor}</td>`
                        result += `<td>${item.department}</td>`
                        result += `<td>${item.treatmentDetail}</td>`
                        result += `<td>${item.period}</td>`
                        result += `<td>${item.roomName}</td>`
                        result += `<td>${item.dateTime}</td>`
                        result += `<td>${item.sequence_number}</td></tr></tbody>`
                        count++;


                    })
                    $("#count").html(`查詢結果共有${count}筆`);
                    $("#table1").html(result);

                }






            })

        })
    </script>

}